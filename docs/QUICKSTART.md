# Quick Start: Real-Time Log Analysis System

## Architecture Overview

The system operates in three components:

1. **NSL-KDD Converter** (`backend/kdd_to_network_log.py`) — Appends NSL-KDD test lines to `backend/network.log`
2. **Backend API** (`backend/main.py`) — Tails logs, predicts anomalies, streams to frontend
3. **Frontend Dashboard** (`frontend/`) — Displays live logs with explainability

---

## Step 1: Start the Backend

```powershell
cd "E:\Duk\S3\AI Pro\backend"
python -m uvicorn main:app --host 127.0.0.1 --port 8000 --reload
```

The backend will:
- Load ML models from `backend/models/`
- Create `network.log` if it doesn't exist
- Start tailing the log file for new entries
- Stream parsed + predicted events via `/stream` (SSE)

---

## Step 2: Start the Frontend

```powershell
cd "E:\Duk\S3\AI Pro\frontend"
npm install
npm run dev
```

Open http://localhost:3000 in your browser. The dashboard will:
- Fetch recent history from `GET http://localhost:8000/logs?limit=40`
- Connect to backend SSE stream at `GET http://localhost:8000/stream`
- Show "Listening for logs" until events arrive

---

## Step 3: Append NSL-KDD Logs

Open a **new terminal** and run:

```powershell
cd "E:\Duk\S3\AI Pro\backend"
python kdd_to_network_log.py --delay 1.0 --limit 100 --start 0
```

This reads `data/nsl-kdd/KDDTest+.txt` and appends lines to `backend/network.log`.

### Converter Options

```powershell
# Append 50 lines instantly (no delay)
python kdd_to_network_log.py --limit 50 --burst

# Append 200 lines slowly (1.5s apart), starting at line 100
python kdd_to_network_log.py --limit 200 --delay 1.5 --start 100
```

---

## What You'll See

### Frontend Dashboard

1. **Alert Banner** (top): Shows recent Critical/Warning alerts with scores
2. **Analyzing Indicator**: Flashes briefly when processing new logs
3. **Log Table**:
   - Raw CSV log text
   - User ID (from `attack_type`)
   - Anomaly score (0-1)
   - Severity (Normal/Warning/Critical)
   - Click any row to see details
4. **Right Panel**:
   - Stats cards (Total/Normal/Warning/Critical counts)
   - **Log Details** section:
     - User behavior flags
     - Top contributing features (if provided)
   - System status

### Backend Logs

Watch the backend terminal for:
```
INFO:     127.0.0.1:xxxxx - "GET /stream HTTP/1.1" 200 OK
```

Each new log line is parsed, scored, and streamed.

---

## Log Format

`network.log` is CSV with 43 values:

```
timestamp,attack_type,<41 NSL-KDD features>
```

Example line (truncated):
```
14:23:01,neptune,0,tcp,http,SF,181,5450,0,0,0,0,...
```

Generated by `backend/kdd_to_network_log.py` from NSL-KDD test set.

---

## Explainability Features

### User Behavior Flags

Backend flags behaviors from NSL-KDD fields, e.g.:
- Multiple failed logins
- Root shell access / SU attempted
- Excessive file creation / compromised indicators
- High error/same-SRV rates
- Large data transfers

If no specific flags, severity-based tags are used.

---

## Troubleshooting

### "Model not fully loaded" (503)
- Ensure `backend/models/` contains:
  - `scaler_nslkdd.joblib`
  - `stacked_encoder.onnx`
  - `rf_encoded.joblib`

### No logs appearing
- Verify `kdd_to_network_log.py` is appending to `backend/network.log`
- Confirm backend started before running the converter
- Check backend console for parse errors

### Frontend hydration issues
- The UI loads data after mount; refresh if any mismatch persists

---

## Production Considerations

1. **Persistence**: Use a database/Redis for the event buffer
2. **Real Logs**: Replace NSL-KDD converter with syslog/firewall/IDS feeds
3. **Security**: Add authentication and tighten CORS
4. **Model Updates**: Retrain periodically with labeled data
5. **Deploy**: Add Docker/K8s manifests and CI

---

## Quick Test Sequence

```powershell
# Terminal 1: Backend
cd "E:\Duk\S3\AI Pro\backend"
python -m uvicorn main:app --host 127.0.0.1 --port 8000 --reload

# Terminal 2: Frontend
cd "E:\Duk\S3\AI Pro\frontend"
npm install
npm run dev

# Terminal 3: Append NSL-KDD logs
cd "E:\Duk\S3\AI Pro\backend"
python kdd_to_network_log.py --delay 1.0 --limit 30

# Browser: Open http://localhost:3000
# Watch logs appear in real-time with predictions!
```

---

**Status**: ✅ Ready. Start backend and frontend, then append NSL-KDD logs to see live detection.
